---
# Packages role: install required packages

- name: Detect OS family
  ansible.builtin.setup:
    gather_facts: false
  register: facts

- name: Set OS family fact
  set_fact:
    os_family: "{{ ansible_facts['os_family'] }}"

- name: Install packages on Debian/Ubuntu
  apt:
    name: "{{ common_packages + linux_packages }}"
    state: present
    update_cache: yes
  when: os_family == "Debian"

- name: Install packages on macOS (Homebrew)
  homebrew:
    name: "{{ common_packages + mac_packages }}"
    state: present
  when: os_family == "Darwin"
  ignore_errors: yes

- name: Install starship prompt (all platforms)
  get_url:
    url: https://starship.rs/install.sh
    dest: /tmp/starship-install.sh
    mode: '0755'
  register: starship_install

- name: Run starship installer
  shell: /tmp/starship-install.sh -y
  when: starship_install.changed
