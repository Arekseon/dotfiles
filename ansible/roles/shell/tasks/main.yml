---
# Shell role: ensure correct shell is installed and set as default

- name: Install zsh (Debian/Ubuntu)
  apt:
    name: zsh
    state: present
  become: yes
  when: shell == "zsh" and ansible_facts['os_family'] == "Debian"

- name: Install zsh (macOS) -- pre-installed on macOS Catalina+
  debug:
    msg: "zsh is pre-installed on macOS"
  when: shell == "zsh" and ansible_facts['os_family'] == "Darwin"

- name: Get current shell
  command: echo $SHELL
  register: current_shell
  changed_when: false
  check_mode: false

- name: Set default shell to zsh
  user:
    name: "{{ ansible_user }}"
    shell: /bin/zsh
  become: yes
  when: shell == "zsh" and current_shell.stdout != "/bin/zsh"

- name: Set default shell to bash (latest)
  user:
    name: "{{ ansible_user }}"
    shell: /bin/bash
  become: yes
  when: shell == "bash" and current_shell.stdout != "/bin/bash"
